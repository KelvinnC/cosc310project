============================= test session starts ==============================
platform darwin -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- /Library/Frameworks/Python.framework/Versions/3.12/bin/python3.12
cachedir: .pytest_cache
rootdir: /Users/willkwan/Desktop/cosc310project/backend
configfile: pytest.ini
plugins: mock-3.15.1, anyio-4.11.0, asyncio-1.3.0, cov-7.0.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 356 items

tests/test_admin_endpoints.py::test_admin_summary_authorized_user PASSED [  0%]
tests/test_admin_endpoints.py::test_admin_summary_unauthorized_user PASSED [  0%]
tests/test_admin_logging.py::test_warn_user_logs_action PASSED           [  0%]
tests/test_admin_logging.py::test_unwarn_user_logs_action PASSED         [  1%]
tests/test_admin_logging.py::test_ban_user_logs_action PASSED            [  1%]
tests/test_admin_logging.py::test_unban_user_logs_action PASSED          [  1%]
tests/test_admin_logging.py::test_hide_review_logs_success PASSED        [  1%]
tests/test_admin_logging.py::test_hide_review_logs_not_found PASSED      [  2%]
tests/test_admin_logging.py::test_flag_review_logs_action PASSED         [  2%]
tests/test_admin_logging.py::test_duplicate_flag_logs_warning PASSED     [  2%]
tests/test_admin_review_service.py::test_get_flagged_reviews_no_reviews PASSED [  3%]
tests/test_admin_review_service.py::test_get_flagged_reviews_has_flagged PASSED [  3%]
tests/test_admin_review_service.py::test_get_flagged_reviews_has_flagged_and_unflagged PASSED [  3%]
tests/test_admin_review_service.py::test_hide_review_hides_review PASSED [  3%]
tests/test_admin_user_service.py::test_get_user_count_one_user PASSED    [  4%]
tests/test_admin_user_service.py::test_get_user_count_no_users PASSED    [  4%]
tests/test_admin_user_service.py::test_get_warned_users PASSED           [  4%]
tests/test_admin_user_service.py::test_get_warned_users_no_warned_users PASSED [  5%]
tests/test_admin_user_service.py::test_get_banned_users PASSED           [  5%]
tests/test_admin_user_service.py::test_get_banned_users_no_banned_users PASSED [  5%]
tests/test_auth_middleware.py::test_missing_header PASSED                [  5%]
tests/test_auth_middleware.py::test_valid_token PASSED                   [  6%]
tests/test_auth_middleware.py::test_expired_token PASSED                 [  6%]
tests/test_battle_e2e.py::TestBattleE2E::test_server_is_running PASSED   [  6%]
tests/test_battle_e2e.py::TestBattleE2E::test_create_battle_requires_auth PASSED [  7%]
tests/test_battle_e2e.py::TestBattleE2E::test_create_battle_success PASSED [  7%]
tests/test_battle_e2e.py::TestBattleE2E::test_submit_vote_success PASSED [  7%]
tests/test_battle_e2e.py::TestBattleE2E::test_submit_vote_invalid_winner PASSED [  7%]
tests/test_battle_e2e.py::TestBattleE2E::test_duplicate_vote_rejected PASSED [  8%]
tests/test_battle_e2e.py::TestBattleE2E::test_multiple_battles_persistence PASSED [  8%]
tests/test_battle_e2e.py::TestBattleE2E::test_exhausted_pairs_returns_error PASSED [  8%]
tests/test_battle_e2e.py::TestBattleE2E::test_battle_vote_without_auth PASSED [  8%]
tests/test_battle_endpoints.py::test_create_battle_success PASSED        [  9%]
tests/test_battle_endpoints.py::test_create_battle_user_not_found PASSED [  9%]
tests/test_battle_endpoints.py::test_create_battle_no_reviews PASSED     [  9%]
tests/test_battle_endpoints.py::test_create_battle_no_eligible_pairs PASSED [ 10%]
tests/test_battle_endpoints.py::test_create_battle_file_error PASSED     [ 10%]
tests/test_battle_endpoints.py::test_submit_vote_success PASSED          [ 10%]
tests/test_battle_endpoints.py::test_submit_vote_user_not_found PASSED   [ 10%]
tests/test_battle_endpoints.py::test_submit_vote_battle_not_found PASSED [ 11%]
tests/test_battle_endpoints.py::test_submit_vote_invalid_winner PASSED   [ 11%]
tests/test_battle_endpoints.py::test_submit_vote_duplicate_vote PASSED   [ 11%]
tests/test_battle_endpoints.py::test_submit_vote_increment_failure PASSED [ 12%]
tests/test_battle_endpoints.py::test_get_battle_success PASSED           [ 12%]
tests/test_battle_endpoints.py::test_get_battle_not_found PASSED         [ 12%]
tests/test_battle_pair_selector.py::TestLoadUserBattles::test_filters_battles_by_user_id PASSED [ 12%]
tests/test_battle_pair_selector.py::TestLoadUserBattles::test_returns_empty_list_when_no_battles PASSED [ 13%]
tests/test_battle_pair_selector.py::TestLoadUserBattles::test_returns_empty_list_when_no_matching_user PASSED [ 13%]
tests/test_battle_pair_selector.py::TestLoadUserBattles::test_handles_none_from_load_all PASSED [ 13%]
tests/test_battle_pair_selector.py::TestGetUserVotedPairs::test_returns_frozenset_of_voted_pairs PASSED [ 14%]
tests/test_battle_pair_selector.py::TestGetUserVotedPairs::test_ignores_unvoted_battles PASSED [ 14%]
tests/test_battle_pair_selector.py::TestGetUserVotedPairs::test_returns_empty_set_when_no_battles PASSED [ 14%]
tests/test_battle_pair_selector.py::TestGetUserVotedPairs::test_frozenset_is_unordered PASSED [ 14%]
tests/test_battle_pair_selector.py::TestIsOwnReview::test_returns_true_when_user_is_author PASSED [ 15%]
tests/test_battle_pair_selector.py::TestIsOwnReview::test_returns_false_when_user_is_not_author PASSED [ 15%]
tests/test_battle_pair_selector.py::TestIsOwnReview::test_handles_integer_author_id PASSED [ 15%]
tests/test_battle_pair_selector.py::TestIsOwnReview::test_string_comparison_is_used PASSED [ 16%]
tests/test_battle_pair_selector.py::TestFilterEligibleReviews::test_excludes_user_own_reviews PASSED [ 16%]
tests/test_battle_pair_selector.py::TestFilterEligibleReviews::test_returns_empty_list_when_all_reviews_are_own PASSED [ 16%]
tests/test_battle_pair_selector.py::TestFilterEligibleReviews::test_returns_all_reviews_when_none_are_own PASSED [ 16%]
tests/test_battle_pair_selector.py::TestFilterEligibleReviews::test_handles_empty_list PASSED [ 17%]
tests/test_battle_pair_selector.py::TestGenerateEligiblePairs::test_produces_all_unique_pairs PASSED [ 17%]
tests/test_battle_pair_selector.py::TestGenerateEligiblePairs::test_respects_voted_pairs_exclusion PASSED [ 17%]
tests/test_battle_pair_selector.py::TestGenerateEligiblePairs::test_with_three_reviews_and_one_voted_pair PASSED [ 17%]
tests/test_battle_pair_selector.py::TestGenerateEligiblePairs::test_returns_empty_when_all_pairs_voted PASSED [ 18%]
tests/test_battle_pair_selector.py::TestGenerateEligiblePairs::test_handles_single_review PASSED [ 18%]
tests/test_battle_pair_selector.py::TestGenerateEligiblePairs::test_handles_empty_reviews PASSED [ 18%]
tests/test_battle_pair_selector.py::TestSampleReviewsForBattle::test_excludes_user_authored_reviews PASSED [ 19%]
tests/test_battle_pair_selector.py::TestSampleReviewsForBattle::test_respects_sample_size_limit PASSED [ 19%]
tests/test_battle_pair_selector.py::TestSampleReviewsForBattle::test_returns_all_when_below_sample_size PASSED [ 19%]
tests/test_battle_pair_selector.py::TestSampleReviewsForBattle::test_handles_empty_review_list PASSED [ 19%]
tests/test_battle_pair_selector.py::TestSampleReviewsForBattle::test_handles_all_reviews_by_user PASSED [ 20%]
tests/test_battle_pair_selector.py::TestSelectEligiblePair::test_returns_valid_pair_tuple PASSED [ 20%]
tests/test_battle_pair_selector.py::TestSelectEligiblePair::test_excludes_user_own_reviews_from_pair PASSED [ 20%]
tests/test_battle_pair_selector.py::TestSelectEligiblePair::test_raises_value_error_when_no_eligible_pairs PASSED [ 21%]
tests/test_battle_pair_selector.py::TestSelectEligiblePair::test_raises_value_error_when_all_pairs_voted PASSED [ 21%]
tests/test_battle_pair_selector.py::TestSelectEligiblePair::test_avoids_already_voted_pairs PASSED [ 21%]
tests/test_battle_pair_selector.py::TestSelectEligiblePair::test_handles_minimal_case_two_reviews PASSED [ 21%]
tests/test_battle_repo.py::test_load_all_file_missing PASSED             [ 22%]
tests/test_battle_repo.py::test_load_all_with_data PASSED                [ 22%]
tests/test_battle_repo.py::test_save_all_saves_data PASSED               [ 22%]
tests/test_battle_schema.py::test_missing_required_fields PASSED         [ 23%]
tests/test_battle_schema.py::test_valid_battle PASSED                    [ 23%]
tests/test_battle_schema.py::test_battle_with_winner PASSED              [ 23%]
tests/test_battle_schema.py::test_battle_same_review_ids_raises_error PASSED [ 23%]
tests/test_battle_service.py::test_create_battle_excludes_own_reviews PASSED [ 24%]
tests/test_battle_service.py::test_create_battle_no_eligible_pairs PASSED [ 24%]
tests/test_battle_service.py::test_create_battle_single_eligible_pair PASSED [ 24%]
tests/test_battle_service.py::test_create_battle_all_reviews_owned PASSED [ 25%]
tests/test_battle_service.py::test_create_battle_empty_reviews PASSED    [ 25%]
tests/test_battle_service.py::test_submit_battle_result_success PASSED   [ 25%]
tests/test_battle_service.py::test_submit_battle_result_invalid_winner PASSED [ 25%]
tests/test_battle_service.py::test_submit_battle_result_marks_end_time PASSED [ 26%]
tests/test_battle_service.py::test_submit_battle_result_prevents_duplicate_vote PASSED [ 26%]
tests/test_battle_service.py::test_submit_battle_result_prevents_duplicate_vote_unordered PASSED [ 26%]
tests/test_comment_service.py::test_get_comments_by_review_id_returns_comments_with_usernames PASSED [ 26%]
tests/test_comment_service.py::test_get_comments_by_review_id_returns_empty_list_when_no_comments PASSED [ 27%]
tests/test_comment_service.py::test_create_comment_adds_and_saves_comment PASSED [ 27%]
tests/test_comment_service.py::test_create_comment_starts_at_id_1_if_no_existing_comments PASSED [ 27%]
tests/test_flag_endpoints.py::test_flag_review_requires_authentication PASSED [ 28%]
tests/test_flag_endpoints.py::test_flag_review_success PASSED            [ 28%]
tests/test_flag_endpoints.py::test_flag_review_duplicate_returns_409 PASSED [ 28%]
tests/test_flag_endpoints.py::test_flag_review_invalid_review_returns_404 PASSED [ 28%]
tests/test_flag_endpoints.py::test_flag_review_other_value_error_returns_400 PASSED [ 29%]
tests/test_flag_endpoints.py::test_flag_review_extracts_user_id_from_jwt PASSED [ 29%]
tests/test_flag_endpoints.py::test_flag_review_invalid_path_param_returns_422 PASSED [ 29%]
tests/test_flag_endpoints.py::test_unflag_review_success PASSED          [ 30%]
tests/test_flag_endpoints.py::test_unflag_review_not_found PASSED        [ 30%]
tests/test_flag_integration.py::test_flag_review_integration_persists_and_marks_review PASSED [ 30%]
tests/test_flag_integration.py::test_flag_review_integration_duplicate PASSED [ 30%]
tests/test_flag_service.py::test_flag_review_success PASSED              [ 31%]
tests/test_flag_service.py::test_flag_review_prevents_duplicate PASSED   [ 31%]
tests/test_flag_service.py::test_flag_review_different_users_can_flag PASSED [ 31%]
tests/test_flag_service.py::test_flag_review_marks_review_as_flagged PASSED [ 32%]
tests/test_flag_service.py::test_flag_review_invalid_review PASSED       [ 32%]
tests/test_flag_service.py::test_get_flagged_reviews_count_empty PASSED  [ 32%]
tests/test_flag_service.py::test_get_flagged_reviews_count_single PASSED [ 32%]
tests/test_flag_service.py::test_get_flagged_reviews_count_multiple PASSED [ 33%]
tests/test_flag_service.py::test_get_flagged_reviews_count_different_reviews PASSED [ 33%]
tests/test_flag_service.py::test_flag_review_verifies_collaborator_calls PASSED [ 33%]
tests/test_flag_service.py::test_get_flagged_reviews_count_cross_review_isolation PASSED [ 33%]
tests/test_flag_service.py::test_unflag_review_success PASSED            [ 34%]
tests/test_flag_service.py::test_unflag_review_not_found PASSED          [ 34%]
tests/test_leaderboard_endpoints.py::test_leaderboard_returns_reviews_from_service PASSED [ 34%]
tests/test_leaderboard_endpoints.py::test_leaderboard_handles_no_reviews PASSED [ 35%]
tests/test_leaderboard_sorting.py::test_endpoint_returns_reviews_in_vote_order PASSED [ 35%]
tests/test_leaderboard_sorting.py::test_limit_parameter_works_default_and_custom PASSED [ 35%]
tests/test_leaderboard_sorting.py::test_tie_breaking_by_date_recent_first PASSED [ 35%]
tests/test_list_helpers.py::test_find_index_finds_matching_item PASSED   [ 36%]
tests/test_list_helpers.py::test_find_index_returns_first_match PASSED   [ 36%]
tests/test_list_helpers.py::test_find_index_not_found PASSED             [ 36%]
tests/test_list_helpers.py::test_find_index_empty_list PASSED            [ 37%]
tests/test_list_helpers.py::test_find_index_complex_predicate PASSED     [ 37%]
tests/test_list_helpers.py::test_find_dict_by_id_string_id PASSED        [ 37%]
tests/test_list_helpers.py::test_find_dict_by_id_integer_id PASSED       [ 37%]
tests/test_list_helpers.py::test_find_dict_by_id_not_found PASSED        [ 38%]
tests/test_list_helpers.py::test_find_dict_by_id_missing_key PASSED      [ 38%]
tests/test_list_helpers.py::test_find_dict_by_id_none_value PASSED       [ 38%]
tests/test_list_helpers.py::test_find_dict_by_id_custom_key PASSED       [ 39%]
tests/test_list_helpers.py::test_find_dict_by_id_empty_list PASSED       [ 39%]
tests/test_list_helpers.py::test_not_found_constant PASSED               [ 39%]
tests/test_list_helpers.py::test_find_index_with_all_false_predicate PASSED [ 39%]
tests/test_list_helpers.py::test_find_index_with_all_true_predicate PASSED [ 40%]
tests/test_logger.py::test_singleton_pattern PASSED                      [ 40%]
tests/test_logger.py::test_logger_creates_file PASSED                    [ 40%]
tests/test_logger.py::test_logger_writes_multiple_entries PASSED         [ 41%]
tests/test_logger.py::test_logger_includes_context PASSED                [ 41%]
tests/test_logger.py::test_logger_includes_timestamp PASSED              [ 41%]
tests/test_movie_endpoints.py::test_list_movies PASSED                   [ 41%]
tests/test_movie_endpoints.py::test_get_movie_by_id_valid_id PASSED      [ 42%]
tests/test_movie_endpoints.py::test_get_movie_by_id_invalid_id PASSED    [ 42%]
tests/test_movie_endpoints.py::test_post_movie_valid_movie PASSED        [ 42%]
tests/test_movie_endpoints.py::test_post_movie_missing_json PASSED       [ 42%]
tests/test_movie_endpoints.py::test_put_movie_valid_put PASSED           [ 43%]
tests/test_movie_endpoints.py::test_put_movie_invalid_put PASSED         [ 43%]
tests/test_movie_endpoints.py::test_delete_movie_valid_movie PASSED      [ 43%]
tests/test_movie_endpoints.py::test_delete_movie_invalid_movie PASSED    [ 44%]
tests/test_movie_endpoints.py::test_search_all_movies_local_only PASSED  [ 44%]
tests/test_movie_endpoints.py::test_search_all_movies_with_tmdb_fallback PASSED [ 44%]
tests/test_movie_endpoints.py::test_search_all_movies_empty_query PASSED [ 44%]
tests/test_movie_repo.py::test_load_all_file_missing PASSED              [ 45%]
tests/test_movie_repo.py::test_load_all_with_data PASSED                 [ 45%]
tests/test_movie_repo.py::test_save_all_saves_data PASSED                [ 45%]
tests/test_movie_service.py::test_list_movie_empty_list PASSED           [ 46%]
tests/test_movie_service.py::test_list_movie_has_movies PASSED           [ 46%]
tests/test_movie_service.py::test_create_movie_adds_movie PASSED         [ 46%]
tests/test_movie_service.py::test_create_movie_collides_id PASSED        [ 46%]
tests/test_movie_service.py::test_create_movie_strips_whitespace PASSED  [ 47%]
tests/test_movie_service.py::test_get_movie_by_id_valid_id PASSED        [ 47%]
tests/test_movie_service.py::test_get_movie_by_id_invalid_id PASSED      [ 47%]
tests/test_movie_service.py::test_update_movie_valid_update PASSED       [ 48%]
tests/test_movie_service.py::test_update_movie_invalid_id PASSED         [ 48%]
tests/test_movie_service.py::test_delete_movie_valid_movie PASSED        [ 48%]
tests/test_movie_service.py::test_delete_movie_invalid_movie PASSED      [ 48%]
tests/test_movie_service.py::test_cache_tmdb_movie_returns_existing PASSED [ 49%]
tests/test_movie_service.py::test_cache_tmdb_movie_fetches_and_saves PASSED [ 49%]
tests/test_movie_service.py::test_cache_tmdb_movie_not_found PASSED      [ 49%]
tests/test_movie_service.py::test_cache_tmdb_movie_invalid_id PASSED     [ 50%]
tests/test_movie_service_sort.py::test_list_movies_no_sort_returns_models_and_does_not_mutate PASSED [ 50%]
tests/test_movie_service_sort.py::test_sort_by_rating_ascending PASSED   [ 50%]
tests/test_movie_service_sort.py::test_sort_by_rating_descending PASSED  [ 50%]
tests/test_movie_service_sort.py::test_sort_by_rating_handles_strings_and_missing PASSED [ 51%]
tests/test_movie_sort_endpoints.py::test_sort_movies_ascending PASSED    [ 51%]
tests/test_movie_sort_endpoints.py::test_sort_movies_descending PASSED   [ 51%]
tests/test_movie_sort_endpoints.py::test_sort_movies_default_order_is_asc PASSED [ 51%]
tests/test_penalty_endpoints.py::test_remove_user_warning_success PASSED [ 52%]
tests/test_penalty_endpoints.py::test_remove_user_warning_unauthorized PASSED [ 52%]
tests/test_penalty_endpoints.py::test_add_user_ban_success PASSED        [ 52%]
tests/test_penalty_endpoints.py::test_add_user_ban_unauthorized PASSED   [ 53%]
tests/test_penalty_endpoints.py::test_remove_user_ban_success PASSED     [ 53%]
tests/test_penalty_endpoints.py::test_remove_user_ban_unauthorized PASSED [ 53%]
tests/test_penalty_service.py::test_penalty_service_valid_warn PASSED    [ 53%]
tests/test_penalty_service.py::test_penalty_service_warn_invalid_user PASSED [ 54%]
tests/test_penalty_service.py::test_penalty_service_valid_unwarn PASSED  [ 54%]
tests/test_penalty_service.py::test_penalty_service_unwarn_invalid_user PASSED [ 54%]
tests/test_penalty_service.py::test_penalty_service_valid_ban PASSED     [ 55%]
tests/test_penalty_service.py::test_penalty_service_warn_invalid_ban PASSED [ 55%]
tests/test_penalty_service.py::test_penalty_service_valid_unban PASSED   [ 55%]
tests/test_penalty_service.py::test_penalty_service_warn_invalid_unban PASSED [ 55%]
tests/test_review_endpoints.py::test_list_reviews PASSED                 [ 56%]
tests/test_review_endpoints.py::test_get_review_by_id_valid_id PASSED    [ 56%]
tests/test_review_endpoints.py::test_get_review_by_id_invalid_id PASSED  [ 56%]
tests/test_review_endpoints.py::test_post_review_valid_review PASSED     [ 57%]
tests/test_review_endpoints.py::test_post_review_missing_json PASSED     [ 57%]
tests/test_review_endpoints.py::test_put_review_valid_put PASSED         [ 57%]
tests/test_review_endpoints.py::test_put_review_invalid_put PASSED       [ 57%]
tests/test_review_endpoints.py::test_delete_review_valid_review PASSED   [ 58%]
tests/test_review_endpoints.py::test_delete_review_invalid_review PASSED [ 58%]
tests/test_review_endpoints.py::test_put_review_unauthorized_user PASSED [ 58%]
tests/test_review_endpoints.py::test_delete_review_unauthorized_user PASSED [ 58%]
tests/test_review_endpoints.py::test_get_review_by_author_id PASSED      [ 59%]
tests/test_review_endpoints.py::test_hide_review_success PASSED          [ 59%]
tests/test_review_endpoints.py::test_hide_review_unauthorized PASSED     [ 59%]
tests/test_review_endpoints.py::test_hide_review_not_found PASSED        [ 60%]
tests/test_review_endpoints.py::test_get_comments_endpoint_returns_list PASSED [ 60%]
tests/test_review_endpoints.py::test_get_comments_returns_empty_list PASSED [ 60%]
tests/test_review_endpoints.py::test_post_comment_creates_comment PASSED [ 60%]
tests/test_review_endpoints_enhanced.py::test_post_review_requires_authentication PASSED [ 61%]
tests/test_review_endpoints_enhanced.py::test_get_review_by_id_service_404_propagates PASSED [ 61%]
tests/test_review_endpoints_enhanced.py::test_get_author_reviews_404_returns_empty_list PASSED [ 61%]
tests/test_review_endpoints_enhanced.py::test_get_author_reviews_non_404_http_error_propagates PASSED [ 62%]
tests/test_review_filter_endpoints.py::test_filter_and_sort_by_rating_desc PASSED [ 62%]
tests/test_review_filter_endpoints.py::test_sort_by_movie_title_asc PASSED [ 62%]
tests/test_review_repo.py::test_get_all_reviews_returns_copy_when_no_filter_or_sort PASSED [ 62%]
tests/test_review_repo.py::test_filter_by_rating_exact_match PASSED      [ 63%]
tests/test_review_repo.py::test_load_all_file_missing PASSED             [ 63%]
tests/test_review_repo.py::test_load_all_with_data PASSED                [ 63%]
tests/test_review_repo.py::test_save_all_saves_data PASSED               [ 64%]
tests/test_review_repo.py::test_sort_by_rating_ascending_descending PASSED [ 64%]
tests/test_review_repo.py::test_sort_by_movie_id_supports_uuid PASSED    [ 64%]
tests/test_review_repo.py::test_sort_by_movie_title_ascending_descending PASSED [ 64%]
tests/test_review_search.py::test_search_by_review_title PASSED          [ 65%]
tests/test_review_search.py::test_search_by_review_body PASSED           [ 65%]
tests/test_review_search.py::test_search_by_movie_title PASSED           [ 65%]
tests/test_review_search.py::test_search_case_insensitive PASSED         [ 66%]
tests/test_review_search.py::test_search_multiple_matches PASSED         [ 66%]
tests/test_review_search.py::test_search_no_matches PASSED               [ 66%]
tests/test_review_search.py::test_search_empty_string_returns_all PASSED [ 66%]
tests/test_review_search.py::test_search_with_pagination PASSED          [ 67%]
tests/test_review_search.py::test_search_combined_with_rating_filter PASSED [ 67%]
tests/test_review_search.py::test_search_endpoint_basic PASSED           [ 67%]
tests/test_review_search.py::test_search_endpoint_movie_title PASSED     [ 67%]
tests/test_review_search.py::test_search_endpoint_with_sort PASSED       [ 68%]
tests/test_review_search.py::test_search_by_tmdb_movie_title PASSED      [ 68%]
tests/test_review_search.py::test_search_by_tmdb_movie_partial_title PASSED [ 68%]
tests/test_review_search.py::test_search_mixed_local_and_tmdb_movies PASSED [ 69%]
tests/test_review_service.py::test_list_review_empty_list PASSED         [ 69%]
tests/test_review_service.py::test_list_review_has_reviews PASSED        [ 69%]
tests/test_review_service.py::test_create_review_adds_review PASSED      [ 69%]
tests/test_review_service.py::test_create_review_collides_id PASSED      [ 70%]
tests/test_review_service.py::test_create_review_strips_whitespace PASSED [ 70%]
tests/test_review_service.py::test_get_review_by_id_valid_id PASSED      [ 70%]
tests/test_review_service.py::test_get_review_by_id_invalid_id PASSED    [ 71%]
tests/test_review_service.py::test_update_review_valid_update PASSED     [ 71%]
tests/test_review_service.py::test_update_review_invalid_id PASSED       [ 71%]
tests/test_review_service.py::test_delete_review_valid_review PASSED     [ 71%]
tests/test_review_service.py::test_delete_review_invalid_review PASSED   [ 72%]
tests/test_review_service.py::test_increment_vote_successful PASSED      [ 72%]
tests/test_review_service.py::test_increment_vote_from_zero PASSED       [ 72%]
tests/test_review_service.py::test_increment_vote_missing_votes_field PASSED [ 73%]
tests/test_review_service.py::test_increment_vote_review_not_found PASSED [ 73%]
tests/test_review_service.py::test_increment_vote_multiple_reviews PASSED [ 73%]
tests/test_review_service.py::test_get_review_by_author_id PASSED        [ 73%]
tests/test_review_service_sort.py::test_list_reviews_no_sort_returns_models_and_does_not_mutate PASSED [ 74%]
tests/test_review_service_sort.py::test_filter_by_rating_exact_match PASSED [ 74%]
tests/test_review_service_sort.py::test_sort_by_rating_ascending_descending PASSED [ 74%]
tests/test_review_service_sort.py::test_sort_by_movie_id_supports_uuid_and_index PASSED [ 75%]
tests/test_review_service_sort.py::test_sort_by_movie_title_ascending_descending PASSED [ 75%]
tests/test_search_endpoints.py::test_search_movies_with_reviews_uuid_ids PASSED [ 75%]
tests/test_search_endpoints.py::test_search_movies_with_reviews_legacy_integer_ids PASSED [ 75%]
tests/test_search_endpoints.py::test_search_movies_with_reviews_no_match_returns_empty PASSED [ 76%]
tests/test_search_schema.py::test_title_matches_partial_case_insensitive PASSED [ 76%]
tests/test_search_schema.py::test_genre_matches_and_normalization PASSED [ 76%]
tests/test_search_schema.py::test_rating_bounds_validation_error PASSED  [ 76%]
tests/test_search_schema.py::test_rating_matches_range PASSED            [ 77%]
tests/test_search_schema.py::test_search_result_total_computed PASSED    [ 77%]
tests/test_search_service.py::test_search_reviews_by_title_uuid_ids PASSED [ 77%]
tests/test_search_service.py::test_search_reviews_by_title_legacy_integer_ids PASSED [ 78%]
tests/test_search_service.py::test_all_matching_reviews_no_match_returns_empty PASSED [ 78%]
tests/test_search_service.py::test_search_movies_with_reviews_groups_and_shapes PASSED [ 78%]
tests/test_search_service.py::test_search_reviews_by_title_pagination PASSED [ 78%]
tests/test_tmdb_service.py::test_is_tmdb_movie_id PASSED                 [ 79%]
tests/test_tmdb_service.py::test_extract_tmdb_id PASSED                  [ 79%]
tests/test_tmdb_service.py::test_create_tmdb_movie_id PASSED             [ 79%]
tests/test_tmdb_service.py::test_search_tmdb_movies PASSED               [ 80%]
tests/test_tmdb_service.py::test_get_tmdb_movie_details PASSED           [ 80%]
tests/test_tmdb_service.py::test_validate_tmdb_movie_id_valid PASSED     [ 80%]
tests/test_tmdb_service.py::test_validate_tmdb_movie_id_invalid PASSED   [ 80%]
tests/test_tmdb_service.py::test_validate_tmdb_movie_id_uuid_format PASSED [ 81%]
tests/test_tmdb_service.py::test_search_tmdb_movies_no_api_key PASSED    [ 81%]
tests/test_tmdb_service.py::test_search_tmdb_movies_api_error PASSED     [ 81%]
tests/test_tmdb_service.py::test_get_tmdb_movie_details_no_api_key PASSED [ 82%]
tests/test_tmdb_service.py::test_get_tmdb_movie_details_api_error PASSED [ 82%]
tests/test_unified_search.py::test_search_with_many_local_results PASSED [ 82%]
tests/test_unified_search.py::test_search_with_few_local_results PASSED  [ 82%]
tests/test_unified_search.py::test_search_with_no_local_results PASSED   [ 83%]
tests/test_unified_search.py::test_search_tmdb_failure_returns_local_only PASSED [ 83%]
tests/test_unified_search.py::test_search_empty_query PASSED             [ 83%]
tests/test_user_endpoints.py::test_list_users PASSED                     [ 83%]
tests/test_user_endpoints.py::test_get_user_by_id_valid_id PASSED        [ 84%]
tests/test_user_endpoints.py::test_get_user_by_id_invalid_id PASSED      [ 84%]
tests/test_user_endpoints.py::test_post_user_valid_user PASSED           [ 84%]
tests/test_user_endpoints.py::test_post_user_missing_json PASSED         [ 85%]
tests/test_user_endpoints.py::test_post_user_duplicate_username PASSED   [ 85%]
tests/test_user_endpoints.py::test_put_user_valid_put PASSED             [ 85%]
tests/test_user_endpoints.py::test_put_user_invalid_put PASSED           [ 85%]
tests/test_user_endpoints.py::test_put_user_duplicate_username PASSED    [ 86%]
tests/test_user_endpoints.py::test_delete_user_valid_user PASSED         [ 86%]
tests/test_user_endpoints.py::test_delete_user_invalid_user PASSED       [ 86%]
tests/test_user_home_endpoints.py::test_get_user_homepage PASSED         [ 87%]
tests/test_user_home_endpoints.py::test_download_dashboard PASSED        [ 87%]
tests/test_user_home_endpoints.py::test_download_dashboard_unauthenticated PASSED [ 87%]
tests/test_user_login_endpoints.py::test_user_login_endpoint_valid_login PASSED [ 87%]
tests/test_user_login_endpoints.py::test_user_login_endpoint_invalid_login PASSED [ 88%]
tests/test_user_login_service.py::test_user_login_empty_fields PASSED    [ 88%]
tests/test_user_login_service.py::test_user_login_username_invalid PASSED [ 88%]
tests/test_user_login_service.py::test_user_login_password_invalid PASSED [ 89%]
tests/test_user_login_service.py::test_user_login_credentials_valid PASSED [ 89%]
tests/test_user_login_service.py::test_user_login_banned_user PASSED     [ 89%]
tests/test_user_repo.py::test_load_all_file_missing PASSED               [ 89%]
tests/test_user_repo.py::test_load_all_with_data PASSED                  [ 90%]
tests/test_user_repo.py::test_save_all_saves_data PASSED                 [ 90%]
tests/test_user_schema.py::test_missing_required_fields PASSED           [ 90%]
tests/test_user_schema.py::test_valid_user PASSED                        [ 91%]
tests/test_user_schema.py::test_username_too_short PASSED                [ 91%]
tests/test_user_schema.py::test_username_too_long PASSED                 [ 91%]
tests/test_user_schema.py::test_invalid_role PASSED                      [ 91%]
tests/test_user_schema.py::test_user_create_invalid_password PASSED      [ 92%]
tests/test_user_service.py::test_list_user_empty_list PASSED             [ 92%]
tests/test_user_service.py::test_list_user_has_users PASSED              [ 92%]
tests/test_user_service.py::test_list_user_deletes_passwords PASSED      [ 92%]
tests/test_user_service.py::test_create_user_adds_user PASSED            [ 93%]
tests/test_user_service.py::test_create_user_collides_id PASSED          [ 93%]
tests/test_user_service.py::test_create_user_strips_whitespace PASSED    [ 93%]
tests/test_user_service.py::test_create_user_hashes_password PASSED      [ 94%]
tests/test_user_service.py::test_get_user_by_id_valid_id PASSED          [ 94%]
tests/test_user_service.py::test_get_user_by_id_invalid_id PASSED        [ 94%]
tests/test_user_service.py::test_update_user_valid_update PASSED         [ 94%]
tests/test_user_service.py::test_update_user_invalid_id PASSED           [ 95%]
tests/test_user_service.py::test_update_user_password_change PASSED      [ 95%]
tests/test_user_service.py::test_delete_user_valid_user PASSED           [ 95%]
tests/test_user_service.py::test_delete_user_invalid_user PASSED         [ 96%]
tests/test_user_summary_service.py::test_get_users_reviews PASSED        [ 96%]
tests/test_user_summary_service.py::test_get_users_battles PASSED        [ 96%]
tests/test_user_summary_service.py::test_get_user_object PASSED          [ 96%]
tests/test_user_summary_service.py::test_get_user_summary PASSED         [ 97%]
tests/test_validate_access.py::test_valid_token PASSED                   [ 97%]
tests/test_validate_access.py::test_expired_token PASSED                 [ 97%]
tests/test_validate_access.py::test_invalid_token PASSED                 [ 98%]
tests/test_validate_access.py::test_tampered_token PASSED                [ 98%]
tests/test_watchlist_endpoints.py::test_get_watchlist PASSED             [ 98%]
tests/test_watchlist_endpoints.py::test_post_watchlist PASSED            [ 98%]
tests/test_watchlist_service.py::test_get_watchlist_by_author_id PASSED  [ 99%]
tests/test_watchlist_service.py::test_get_watchlist_by_author_id_invalid_id PASSED [ 99%]
tests/test_watchlist_service.py::test_add_movie_to_user_watchlist_valid_id PASSED [ 99%]
tests/test_watchlist_service.py::test_add_movie_to_user_watchlist_invalid_id PASSED [100%]

================================ tests coverage ================================
_______________ coverage: platform darwin, python 3.12.3-final-0 _______________

Name                                     Stmts   Miss  Cover   Missing
----------------------------------------------------------------------
app/__init__.py                              0      0   100%
app/main.py                                 32      0   100%
app/middleware/admin_dependency.py           6      0   100%
app/middleware/auth_middleware.py           20      0   100%
app/repositories/battle_repo.py             17      2    88%   16-17
app/repositories/comments_repo.py           14      8    43%   8-11, 14-17
app/repositories/flag_repo.py               16      3    81%   9, 13-14
app/repositories/movie_repo.py              14      0   100%
app/repositories/review_repo.py             62      2    97%   22, 95
app/repositories/user_repo.py               14      0   100%
app/repositories/watchlist_repo.py          14      6    57%   10-11, 14-17
app/routers/__init__.py                      0      0   100%
app/routers/achievements.py                  8      1    88%   13
app/routers/admin_endpoints.py              12      0   100%
app/routers/battles.py                      51      0   100%
app/routers/leaderboard.py                   8      0   100%
app/routers/login.py                         8      0   100%
app/routers/movies.py                       36      3    92%   39, 43, 52
app/routers/reviews.py                      80      6    92%   42-43, 80, 131-133
app/routers/tmdb.py                         17      9    47%   13-16, 22-26
app/routers/user_endpoints.py               35      2    94%   12, 33
app/routers/user_home.py                    15      0   100%
app/routers/watchlist_endpoints.py          18      1    94%   25
app/schemas/__init__.py                      0      0   100%
app/schemas/achievement.py                  16      0   100%
app/schemas/admin.py                         7      0   100%
app/schemas/battle.py                       19      0   100%
app/schemas/comment.py                      12      0   100%
app/schemas/flag.py                          6      6     0%   1-7
app/schemas/movie.py                        32      0   100%
app/schemas/review.py                       78     15    81%   7-9, 29-31, 50-55, 69-71
app/schemas/search.py                       61     10    84%   8-14, 28, 35, 56
app/schemas/user.py                         31      0   100%
app/schemas/user_login.py                    5      0   100%
app/schemas/watchlist.py                    15      3    80%   7-9
app/services/__init__.py                     0      0   100%
app/services/achievement_service.py         73      6    92%   11, 15-17, 67, 140
app/services/admin_review_service.py        22      0   100%
app/services/admin_summary_service.py        5      0   100%
app/services/admin_user_service.py          15      0   100%
app/services/battle_pair_selector.py        41      0   100%
app/services/battle_service.py              54     10    81%   42-43, 83, 85-86, 96-100
app/services/comment_service.py             22      0   100%
app/services/flag_service.py                30      2    93%   63-64
app/services/movie_service.py              139     39    72%   23-24, 70, 72, 77-83, 94, 133-147, 172-187, 191-196
app/services/penalty_service.py             35      0   100%
app/services/review_service.py             175     15    91%   39, 71, 127, 230-233, 237, 306, 314-321
app/services/search_service.py             100     20    80%   43-45, 77-90, 120-121, 138-139
app/services/tmdb_service.py                60      3    95%   26, 34, 39
app/services/unified_search_service.py      18      0   100%
app/services/user_login_service.py          29      1    97%   13
app/services/user_service.py                66      0   100%
app/services/user_summary_service.py        16      0   100%
app/services/validate_access.py              8      1    88%   8
app/services/watchlist_service.py           26      2    92%   32-33
app/utils/__init__.py                        2      0   100%
app/utils/list_helpers.py                   10      0   100%
app/utils/logger.py                         34      3    91%   25, 46-47
----------------------------------------------------------------------
TOTAL                                     1759    179    90%
============================= 356 passed in 10.88s =============================
