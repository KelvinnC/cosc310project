============================= test session starts ==============================
platform darwin -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- /Users/willkwan/Desktop/cosc310project/venv/bin/python3.12
cachedir: .pytest_cache
rootdir: /Users/willkwan/Desktop/cosc310project
plugins: mock-3.15.1, anyio-4.11.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 221 items

backend/tests/test_admin_endpoints.py::test_admin_summary_authorized_user PASSED [  0%]
backend/tests/test_admin_endpoints.py::test_admin_summary_unauthorized_user PASSED [  0%]
backend/tests/test_admin_review_service.py::test_get_flagged_reviews_no_reviews PASSED [  1%]
backend/tests/test_admin_review_service.py::test_get_flagged_reviews_has_flagged PASSED [  1%]
backend/tests/test_admin_review_service.py::test_get_flagged_reviews_has_flagged_and_unflagged PASSED [  2%]
backend/tests/test_admin_review_service.py::test_hide_review_hides_review PASSED [  2%]
backend/tests/test_admin_user_service.py::test_get_user_count_one_user PASSED [  3%]
backend/tests/test_admin_user_service.py::test_get_user_count_no_users PASSED [  3%]
backend/tests/test_admin_user_service.py::test_get_warned_users PASSED   [  4%]
backend/tests/test_admin_user_service.py::test_get_warned_users_no_warned_users PASSED [  4%]
backend/tests/test_admin_user_service.py::test_get_banned_users PASSED   [  4%]
backend/tests/test_admin_user_service.py::test_get_banned_users_no_banned_users PASSED [  5%]
backend/tests/test_auth_middleware.py::test_missing_header PASSED        [  5%]
backend/tests/test_auth_middleware.py::test_valid_token PASSED           [  6%]
backend/tests/test_auth_middleware.py::test_expired_token PASSED         [  6%]
backend/tests/test_battle_endpoints.py::test_create_battle_success PASSED [  7%]
backend/tests/test_battle_endpoints.py::test_create_battle_user_not_found PASSED [  7%]
backend/tests/test_battle_endpoints.py::test_create_battle_no_reviews PASSED [  8%]
backend/tests/test_battle_endpoints.py::test_create_battle_no_eligible_pairs PASSED [  8%]
backend/tests/test_battle_endpoints.py::test_create_battle_file_error PASSED [  9%]
backend/tests/test_battle_endpoints.py::test_submit_vote_success PASSED  [  9%]
backend/tests/test_battle_endpoints.py::test_submit_vote_user_not_found PASSED [  9%]
backend/tests/test_battle_endpoints.py::test_submit_vote_battle_not_found PASSED [ 10%]
backend/tests/test_battle_endpoints.py::test_submit_vote_invalid_winner PASSED [ 10%]
backend/tests/test_battle_endpoints.py::test_submit_vote_duplicate_vote PASSED [ 11%]
backend/tests/test_battle_endpoints.py::test_submit_vote_increment_failure PASSED [ 11%]
backend/tests/test_battle_endpoints.py::test_get_battle_success PASSED   [ 12%]
backend/tests/test_battle_endpoints.py::test_get_battle_not_found PASSED [ 12%]
backend/tests/test_battle_repo.py::test_load_all_file_missing PASSED     [ 13%]
backend/tests/test_battle_repo.py::test_load_all_with_data PASSED        [ 13%]
backend/tests/test_battle_repo.py::test_save_all_saves_data PASSED       [ 14%]
backend/tests/test_battle_schema.py::test_missing_required_fields PASSED [ 14%]
backend/tests/test_battle_schema.py::test_valid_battle PASSED            [ 14%]
backend/tests/test_battle_schema.py::test_battle_with_winner PASSED      [ 15%]
backend/tests/test_battle_schema.py::test_battle_same_review_ids_raises_error PASSED [ 15%]
backend/tests/test_battle_service.py::test_create_battle_excludes_own_reviews PASSED [ 16%]
backend/tests/test_battle_service.py::test_create_battle_no_eligible_pairs PASSED [ 16%]
backend/tests/test_battle_service.py::test_create_battle_single_eligible_pair PASSED [ 17%]
backend/tests/test_battle_service.py::test_create_battle_all_reviews_owned PASSED [ 17%]
backend/tests/test_battle_service.py::test_create_battle_empty_reviews PASSED [ 18%]
backend/tests/test_battle_service.py::test_submit_battle_result_success PASSED [ 18%]
backend/tests/test_battle_service.py::test_submit_battle_result_invalid_winner PASSED [ 19%]
backend/tests/test_battle_service.py::test_submit_battle_result_marks_end_time PASSED [ 19%]
backend/tests/test_battle_service.py::test_submit_battle_result_prevents_duplicate_vote PASSED [ 19%]
backend/tests/test_battle_service.py::test_submit_battle_result_prevents_duplicate_vote_unordered PASSED [ 20%]
backend/tests/test_flag_endpoints.py::test_flag_review_requires_authentication PASSED [ 20%]
backend/tests/test_flag_endpoints.py::test_flag_review_success PASSED    [ 21%]
backend/tests/test_flag_endpoints.py::test_flag_review_duplicate_returns_409 PASSED [ 21%]
backend/tests/test_flag_endpoints.py::test_flag_review_invalid_review_returns_404 PASSED [ 22%]
backend/tests/test_flag_endpoints.py::test_flag_review_other_value_error_returns_400 PASSED [ 22%]
backend/tests/test_flag_endpoints.py::test_flag_review_generic_exception_returns_500 PASSED [ 23%]
backend/tests/test_flag_endpoints.py::test_flag_review_extracts_user_id_from_jwt PASSED [ 23%]
backend/tests/test_flag_endpoints.py::test_flag_review_invalid_path_param_returns_422 PASSED [ 23%]
backend/tests/test_flag_integration.py::test_flag_review_integration_persists_and_marks_review PASSED [ 24%]
backend/tests/test_flag_integration.py::test_flag_review_integration_duplicate PASSED [ 24%]
backend/tests/test_flag_service.py::test_flag_review_success PASSED      [ 25%]
backend/tests/test_flag_service.py::test_flag_review_prevents_duplicate PASSED [ 25%]
backend/tests/test_flag_service.py::test_flag_review_different_users_can_flag PASSED [ 26%]
backend/tests/test_flag_service.py::test_flag_review_marks_review_as_flagged PASSED [ 26%]
backend/tests/test_flag_service.py::test_flag_review_invalid_review PASSED [ 27%]
backend/tests/test_flag_service.py::test_get_flagged_reviews_count_empty PASSED [ 27%]
backend/tests/test_flag_service.py::test_get_flagged_reviews_count_single PASSED [ 28%]
backend/tests/test_flag_service.py::test_get_flagged_reviews_count_multiple PASSED [ 28%]
backend/tests/test_flag_service.py::test_get_flagged_reviews_count_different_reviews PASSED [ 28%]
backend/tests/test_flag_service.py::test_flag_review_verifies_collaborator_calls PASSED [ 29%]
backend/tests/test_flag_service.py::test_get_flagged_reviews_count_cross_review_isolation PASSED [ 29%]
backend/tests/test_list_helpers.py::test_find_index_finds_matching_item PASSED [ 30%]
backend/tests/test_list_helpers.py::test_find_index_returns_first_match PASSED [ 30%]
backend/tests/test_list_helpers.py::test_find_index_not_found PASSED     [ 31%]
backend/tests/test_list_helpers.py::test_find_index_empty_list PASSED    [ 31%]
backend/tests/test_list_helpers.py::test_find_index_complex_predicate PASSED [ 32%]
backend/tests/test_list_helpers.py::test_find_dict_by_id_string_id PASSED [ 32%]
backend/tests/test_list_helpers.py::test_find_dict_by_id_integer_id PASSED [ 33%]
backend/tests/test_list_helpers.py::test_find_dict_by_id_not_found PASSED [ 33%]
backend/tests/test_list_helpers.py::test_find_dict_by_id_missing_key PASSED [ 33%]
backend/tests/test_list_helpers.py::test_find_dict_by_id_none_value PASSED [ 34%]
backend/tests/test_list_helpers.py::test_find_dict_by_id_custom_key PASSED [ 34%]
backend/tests/test_list_helpers.py::test_find_dict_by_id_empty_list PASSED [ 35%]
backend/tests/test_list_helpers.py::test_not_found_constant PASSED       [ 35%]
backend/tests/test_list_helpers.py::test_find_index_with_all_false_predicate PASSED [ 36%]
backend/tests/test_list_helpers.py::test_find_index_with_all_true_predicate PASSED [ 36%]
backend/tests/test_movie_endpoints.py::test_list_movies PASSED           [ 37%]
backend/tests/test_movie_endpoints.py::test_get_movie_by_id_valid_id PASSED [ 37%]
backend/tests/test_movie_endpoints.py::test_get_movie_by_id_invalid_id PASSED [ 38%]
backend/tests/test_movie_endpoints.py::test_post_movie_valid_movie PASSED [ 38%]
backend/tests/test_movie_endpoints.py::test_post_movie_missing_json PASSED [ 38%]
backend/tests/test_movie_endpoints.py::test_put_movie_valid_put PASSED   [ 39%]
backend/tests/test_movie_endpoints.py::test_put_movie_invalid_put PASSED [ 39%]
backend/tests/test_movie_endpoints.py::test_delete_movie_valid_movie PASSED [ 40%]
backend/tests/test_movie_endpoints.py::test_delete_movie_invalid_movie PASSED [ 40%]
backend/tests/test_movie_repo.py::test_load_all_file_missing PASSED      [ 41%]
backend/tests/test_movie_repo.py::test_load_all_with_data PASSED         [ 41%]
backend/tests/test_movie_repo.py::test_save_all_saves_data PASSED        [ 42%]
backend/tests/test_movie_service.py::test_list_movie_empty_list PASSED   [ 42%]
backend/tests/test_movie_service.py::test_list_movie_has_movies PASSED   [ 42%]
backend/tests/test_movie_service.py::test_create_movie_adds_movie PASSED [ 43%]
backend/tests/test_movie_service.py::test_create_movie_collides_id PASSED [ 43%]
backend/tests/test_movie_service.py::test_create_movie_strips_whitespace PASSED [ 44%]
backend/tests/test_movie_service.py::test_get_movie_by_id_valid_id PASSED [ 44%]
backend/tests/test_movie_service.py::test_get_movie_by_id_invalid_id PASSED [ 45%]
backend/tests/test_movie_service.py::test_update_movie_valid_update PASSED [ 45%]
backend/tests/test_movie_service.py::test_update_movie_invalid_id PASSED [ 46%]
backend/tests/test_movie_service.py::test_delete_movie_valid_movie PASSED [ 46%]
backend/tests/test_movie_service.py::test_delete_movie_invalid_movie PASSED [ 47%]
backend/tests/test_movie_service_sort.py::test_list_movies_no_sort_returns_models_and_does_not_mutate PASSED [ 47%]
backend/tests/test_movie_service_sort.py::test_sort_by_rating_ascending PASSED [ 47%]
backend/tests/test_movie_service_sort.py::test_sort_by_rating_descending PASSED [ 48%]
backend/tests/test_movie_service_sort.py::test_sort_by_rating_handles_strings_and_missing PASSED [ 48%]
backend/tests/test_movie_sort_endpoints.py::test_sort_movies_ascending PASSED [ 49%]
backend/tests/test_movie_sort_endpoints.py::test_sort_movies_descending PASSED [ 49%]
backend/tests/test_movie_sort_endpoints.py::test_sort_movies_default_order_is_asc PASSED [ 50%]
backend/tests/test_penalty_endpoints.py::test_remove_user_warning_success PASSED [ 50%]
backend/tests/test_penalty_endpoints.py::test_remove_user_warning_unauthorized PASSED [ 51%]
backend/tests/test_penalty_endpoints.py::test_add_user_ban_success PASSED [ 51%]
backend/tests/test_penalty_endpoints.py::test_add_user_ban_unauthorized PASSED [ 52%]
backend/tests/test_penalty_endpoints.py::test_remove_user_ban_success PASSED [ 52%]
backend/tests/test_penalty_endpoints.py::test_remove_user_ban_unauthorized PASSED [ 52%]
backend/tests/test_penalty_service.py::test_penalty_service_valid_warn PASSED [ 53%]
backend/tests/test_penalty_service.py::test_penalty_service_warn_invalid_user PASSED [ 53%]
backend/tests/test_penalty_service.py::test_penalty_service_valid_unwarn PASSED [ 54%]
backend/tests/test_penalty_service.py::test_penalty_service_unwarn_invalid_user PASSED [ 54%]
backend/tests/test_penalty_service.py::test_penalty_service_valid_ban PASSED [ 55%]
backend/tests/test_penalty_service.py::test_penalty_service_warn_invalid_ban PASSED [ 55%]
backend/tests/test_penalty_service.py::test_penalty_service_valid_unban PASSED [ 56%]
backend/tests/test_penalty_service.py::test_penalty_service_warn_invalid_unban PASSED [ 56%]
backend/tests/test_review_endpoints.py::test_list_reviews PASSED         [ 57%]
backend/tests/test_review_endpoints.py::test_get_review_by_id_valid_id PASSED [ 57%]
backend/tests/test_review_endpoints.py::test_get_review_by_id_invalid_id PASSED [ 57%]
backend/tests/test_review_endpoints.py::test_post_review_valid_review PASSED [ 58%]
backend/tests/test_review_endpoints.py::test_post_review_missing_json PASSED [ 58%]
backend/tests/test_review_endpoints.py::test_put_review_valid_put PASSED [ 59%]
backend/tests/test_review_endpoints.py::test_put_review_invalid_put PASSED [ 59%]
backend/tests/test_review_endpoints.py::test_delete_review_valid_review PASSED [ 60%]
backend/tests/test_review_endpoints.py::test_delete_review_invalid_review PASSED [ 60%]
backend/tests/test_review_endpoints.py::test_get_review_by_author_id PASSED [ 61%]
backend/tests/test_review_endpoints.py::test_hide_review_success PASSED  [ 61%]
backend/tests/test_review_endpoints.py::test_hide_review_unauthorized PASSED [ 61%]
backend/tests/test_review_endpoints.py::test_hide_review_not_found PASSED [ 62%]
backend/tests/test_review_repo.py::test_get_all_reviews_returns_copy_when_no_filter_or_sort PASSED [ 62%]
backend/tests/test_review_repo.py::test_filter_by_rating_exact_match PASSED [ 63%]
backend/tests/test_review_repo.py::test_load_all_file_missing PASSED     [ 63%]
backend/tests/test_review_repo.py::test_load_all_with_data PASSED        [ 64%]
backend/tests/test_review_repo.py::test_save_all_saves_data PASSED       [ 64%]
backend/tests/test_review_repo.py::test_sort_by_rating_ascending_descending PASSED [ 65%]
backend/tests/test_review_repo.py::test_sort_by_movie_id_supports_uuid_and_index PASSED [ 65%]
backend/tests/test_review_repo.py::test_sort_by_movie_title_ascending_descending PASSED [ 66%]
backend/tests/test_review_service.py::test_list_review_empty_list PASSED [ 66%]
backend/tests/test_review_service.py::test_list_review_has_reviews PASSED [ 66%]
backend/tests/test_review_service.py::test_create_review_adds_review PASSED [ 67%]
backend/tests/test_review_service.py::test_create_review_collides_id PASSED [ 67%]
backend/tests/test_review_service.py::test_create_review_strips_whitespace PASSED [ 68%]
backend/tests/test_review_service.py::test_get_review_by_id_valid_id PASSED [ 68%]
backend/tests/test_review_service.py::test_get_review_by_id_invalid_id PASSED [ 69%]
backend/tests/test_review_service.py::test_update_review_valid_update PASSED [ 69%]
backend/tests/test_review_service.py::test_update_review_invalid_id PASSED [ 70%]
backend/tests/test_review_service.py::test_delete_review_valid_review PASSED [ 70%]
backend/tests/test_review_service.py::test_delete_review_invalid_review PASSED [ 71%]
backend/tests/test_review_service.py::test_increment_vote_successful PASSED [ 71%]
backend/tests/test_review_service.py::test_increment_vote_from_zero PASSED [ 71%]
backend/tests/test_review_service.py::test_increment_vote_missing_votes_field PASSED [ 72%]
backend/tests/test_review_service.py::test_increment_vote_review_not_found PASSED [ 72%]
backend/tests/test_review_service.py::test_increment_vote_multiple_reviews PASSED [ 73%]
backend/tests/test_review_service.py::test_get_review_by_author_id PASSED [ 73%]
backend/tests/test_search_endpoints.py::test_search_movies_with_reviews_uuid_ids PASSED [ 74%]
backend/tests/test_search_endpoints.py::test_search_movies_with_reviews_legacy_integer_ids PASSED [ 74%]
backend/tests/test_search_endpoints.py::test_search_movies_with_reviews_no_match_returns_empty PASSED [ 75%]
backend/tests/test_search_schema.py::test_title_matches_partial_case_insensitive PASSED [ 75%]
backend/tests/test_search_schema.py::test_genre_matches_and_normalization PASSED [ 76%]
backend/tests/test_search_schema.py::test_rating_bounds_validation_error PASSED [ 76%]
backend/tests/test_search_schema.py::test_rating_matches_range PASSED    [ 76%]
backend/tests/test_search_schema.py::test_search_result_total_computed PASSED [ 77%]
backend/tests/test_search_service.py::test_search_reviews_by_title_uuid_ids PASSED [ 77%]
backend/tests/test_search_service.py::test_search_reviews_by_title_legacy_integer_ids PASSED [ 78%]
backend/tests/test_search_service.py::test_all_matching_reviews_no_match_returns_empty PASSED [ 78%]
backend/tests/test_search_service.py::test_search_movies_with_reviews_groups_and_shapes PASSED [ 79%]
backend/tests/test_search_service.py::test_search_reviews_by_title_pagination PASSED [ 79%]
backend/tests/test_user_endpoints.py::test_list_users PASSED             [ 80%]
backend/tests/test_user_endpoints.py::test_get_user_by_id_valid_id PASSED [ 80%]
backend/tests/test_user_endpoints.py::test_get_user_by_id_invalid_id PASSED [ 80%]
backend/tests/test_user_endpoints.py::test_post_user_valid_user PASSED   [ 81%]
backend/tests/test_user_endpoints.py::test_post_user_missing_json PASSED [ 81%]
backend/tests/test_user_endpoints.py::test_post_user_duplicate_username PASSED [ 82%]
backend/tests/test_user_endpoints.py::test_put_user_valid_put PASSED     [ 82%]
backend/tests/test_user_endpoints.py::test_put_user_invalid_put PASSED   [ 83%]
backend/tests/test_user_endpoints.py::test_put_user_duplicate_username PASSED [ 83%]
backend/tests/test_user_endpoints.py::test_delete_user_valid_user PASSED [ 84%]
backend/tests/test_user_endpoints.py::test_delete_user_invalid_user PASSED [ 84%]
backend/tests/test_user_login_endpoints.py::test_user_login_endpoint_valid_login PASSED [ 85%]
backend/tests/test_user_login_endpoints.py::test_user_login_endpoint_invalid_login PASSED [ 85%]
backend/tests/test_user_login_service.py::test_user_login_empty_fields PASSED [ 85%]
backend/tests/test_user_login_service.py::test_user_login_username_invalid PASSED [ 86%]
backend/tests/test_user_login_service.py::test_user_login_password_invalid PASSED [ 86%]
backend/tests/test_user_login_service.py::test_user_login_credentials_valid PASSED [ 87%]
backend/tests/test_user_login_service.py::test_user_login_banned_user PASSED [ 87%]
backend/tests/test_user_repo.py::test_load_all_file_missing PASSED       [ 88%]
backend/tests/test_user_repo.py::test_load_all_with_data PASSED          [ 88%]
backend/tests/test_user_repo.py::test_save_all_saves_data PASSED         [ 89%]
backend/tests/test_user_schema.py::test_missing_required_fields PASSED   [ 89%]
backend/tests/test_user_schema.py::test_valid_user PASSED                [ 90%]
backend/tests/test_user_schema.py::test_username_too_short PASSED        [ 90%]
backend/tests/test_user_schema.py::test_username_too_long PASSED         [ 90%]
backend/tests/test_user_schema.py::test_invalid_role PASSED              [ 91%]
backend/tests/test_user_schema.py::test_user_create_invalid_password PASSED [ 91%]
backend/tests/test_user_service.py::test_list_user_empty_list PASSED     [ 92%]
backend/tests/test_user_service.py::test_list_user_has_users PASSED      [ 92%]
backend/tests/test_user_service.py::test_list_user_deletes_passwords PASSED [ 93%]
backend/tests/test_user_service.py::test_create_user_adds_user PASSED    [ 93%]
backend/tests/test_user_service.py::test_create_user_collides_id PASSED  [ 94%]
backend/tests/test_user_service.py::test_create_user_strips_whitespace PASSED [ 94%]
backend/tests/test_user_service.py::test_create_user_hashes_password PASSED [ 95%]
backend/tests/test_user_service.py::test_get_user_by_id_valid_id PASSED  [ 95%]
backend/tests/test_user_service.py::test_get_user_by_id_invalid_id PASSED [ 95%]
backend/tests/test_user_service.py::test_update_user_valid_update PASSED [ 96%]
backend/tests/test_user_service.py::test_update_user_invalid_id PASSED   [ 96%]
backend/tests/test_user_service.py::test_update_user_password_change PASSED [ 97%]
backend/tests/test_user_service.py::test_delete_user_valid_user PASSED   [ 97%]
backend/tests/test_user_service.py::test_delete_user_invalid_user PASSED [ 98%]
backend/tests/test_validate_access.py::test_valid_token PASSED           [ 98%]
backend/tests/test_validate_access.py::test_expired_token PASSED         [ 99%]
backend/tests/test_validate_access.py::test_invalid_token PASSED         [ 99%]
backend/tests/test_validate_access.py::test_tampered_token PASSED        [100%]

============================= 221 passed in 5.57s ==============================
